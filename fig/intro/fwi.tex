%% TikZ styles

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\tikzset{myrectangle/.style={rectangle,draw=black,text width=7.5cm, minimum height=.7cm,text centered}}

\tikzset{myrectangle2/.style={rectangle,draw=black,text width=6.7cm, minimum height=.7cm,text centered}}

\tikzset{myrectangle3/.style={rectangle,draw=black,text width=11cm, minimum height=.7cm,text centered}}

\tikzset{myrectangle4/.style={rectangle,draw=black,text width=9.5cm, minimum height=.7cm,text centered}}

\tikzset{myrectangle5/.style={rectangle,draw=black,text width=5.8cm, minimum height=.7cm,text centered}}

\tikzset{myrectangle6/.style={rectangle,draw=black,text width=6.0cm, minimum height=.7cm,text centered}}

\tikzset{myrectangle7/.style={rectangle,draw=black,text width=7.4cm, minimum height=.7cm,text centered}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\tikzset{
  block1/.style={draw=black,line width=3pt,
                 rounded corners,
                 text centered,
                 minimum height=2cm,
                 text width    =10cm},
  block2/.style={%text centered,
                 minimum height=10cm,
                 text width    =17cm},
  arrowStyle/.style={->, line width=100pt,shorten <=2pt, shorten >=2pt}
}

\begin{tikzpicture} %% [every node/.style={scale=1}]


  \node(ghost){};
  \node[myrectangle,right       =    of ghost ]  (init)  {Initial model (m)};
  \node[myrectangle3,below      =1.0  of init  ]  (num)   {Forward Simulation (m)
                                                          \medskip
                                                          \begin{center}
                                                            \includegraphics[scale=0.6]{fig/simu.png}
                                                           \end{center}};
  \node[myrectangle6,left       =6.0 of num   ]  (misfit){Cost function \\ ($\CF$)};
  \node[myrectangle5,above       =1.5 of misfit]  (obs)   {Observations (data)};
  \node[myrectangle4,below       =3.5 of num   ]  (grad)  {Gradient computation};
  \node[myrectangle7,below left = 0.4   of num   ]  (bwd)   {\textbf{Adjoint \\ Simulation} (m)};
  \node[myrectangle2,below right =0.4 of num   ]  (update){Update model (m)};

   \draw[line width=5pt,color=black,->]   (init.south)  -- (num.north);

   \draw[line width=5pt,color=black,->]   (obs.south)   -- (misfit.north);

   \draw[line width=5pt,color=\myred,->]  (num.west)   -- (misfit.east);

   \draw[line width=5pt,color=black,->]  (misfit.south) |-(bwd.west);

   \draw[line width=5pt,color=\myred,->]  (num.west) -| (bwd.north);

   \draw[line width=5pt,color=\myred,->]  (bwd.south) |- (grad.west);

   \draw[line width=5pt,color=\myred,->]  (grad.east) -| (update.south);

   \draw[line width=5pt,color=\myred,->]  (update.north) |- (num.east);


  %% \node[] (ghost1){};
  %% \node[below=4 of ghost1] (ghost2){};
  %% \node[below=1 of ghost1] (ghost3){};
  %% \node[block1,right=1 of ghost1] (start){initial model $m$};
  %% \node[block1,left =3 of ghost3] (data) {observation $\forward(m^\dagger)$ \\ (receivers data)};
  %% \node[block1,right=1 of ghost2] (mod)  {numerical simulation \\
  %%                                         \medskip
  %%                                         \begin{center}
  %%                                           \includegraphics[scale=1]{fig/intro/modelling.pdf}
  %%                                           %\input{fig/intro/modelling.tex}
  %%                                         \end{center}
  %%                                         };
  %% \node[block1,below=4 of ghost2,anchor=center](res)  {residuals \\
  %%                                      $\misfit = \Vert \forward(m^\dagger) - \forward(m)\Vert$};
  %% \node[block1,below=6 of mod]   (updt) {update $m$};
  %% \node[below=1.7 of updt,anchor=center](caption) {
  %% FWI iterative algorithm until $\misfit(m) \rightarrow 0$. \hspace*{3cm}};
  %% %% Paths
  %% \draw[arrowStyle]    (start.south) to[] (mod.north);
  %% \draw[arrowStyle,red](mod.south)   to[out=-90,in=0]    (res.east);
  %% \draw[arrowStyle]    (data.south)  to[out=-90,in=-180] (res.west);
  %% \draw[arrowStyle,red](res.south)   to[out=-90,in=-180] (updt.west);
  %% \draw[arrowStyle,red](updt.east)   to[out=0 ,in=0]   (mod.east);

  %% %% some legend
  %% \node[block2,left=.1 of res,anchor=east] (info) {
  %%   \vspace*{5cm}

  %%   \begin{itemize}
  %%     \item $m^\dagger$ the `true' model(s)
  %%     \item $\forward$ the forward operator
  %%     \item Modeling with \textbf{DG} method
  %%     \item Numerically expensive (parallel computation required)
  %%     \item Iterative minimization techniques for
  %%           large scale problem (no Hessian)
  %%   \end{itemize}
  %%   };
\end{tikzpicture}
